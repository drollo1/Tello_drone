#include "Tello_drone.h"
#include <iostream>

#define PORT	8889

Tello_drone::Tello_drone(){
	isConnected = false;
}

Tello_drone::~Tello_drone(){

}

int Tello_drone::connectDrone(){
	if(!isConnected){
		//create socket descriptor
		int sock;
		if (0 > (sock = socket(AF_INET, SOCK_DGRAM, 0))){
			printf("Can't create UDP sockect");
			fflush(stdout);
			return sock;
		}

		struct sockaddr_in resaddr;
		memset(&resaddr, 0, sizeof(resaddr));
		resaddr.sin_family = AF_INET;
		resaddr.sin_port = htons(PORT);
		resaddr.sin_addr.s_addr = htonl(INADDR_ANY);
		if (0 > (bind(sock, (struct sockaddr *) &resaddr, sizeof(&resaddr)))){
			printf("couldn't bind to port %d\n", PORT);
			fflush(stdout);
			return -1;
		}

		struct sockaddr_in droneaddr;
		droneaddr.sin_family = AF_INET;
		droneaddr.sin_port = htons(PORT);
		droneaddr.sin_addr.s_addr = htol("192.168.10.1");

		char* buffer[256];
		cahr* command = "command";

		int n = sendto(sock, (char*)command, strlen(command), 0, (sockaddr *) &droneaddr, sizeof(droneaddr));

		close(sock);
		return 1;
	}
	else{
		printf("Already Connected to tello drone\n");
		fflush(stdout);
		return 0;
	}
}
